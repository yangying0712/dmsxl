# MySQL建表错误对比

## 一、user表

### 错误示例：
```sql
CREATE TABLE user (
    id BIGINT NOT NULL AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    password VARCGAR(255) NOT NULL,           -- ❌ 拼写错误
    Real_name VARCHAR(50) NULL,               -- ❌ 命名不规范
    phone VARCHAR(20) NULL,
    email VARCHAR(100) NULL,
    role ENUM('USER','ADMIN') NULL DEFAULT 'USER',  -- ✅ 正确
    Create_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,  -- ❌ 命名不规范
    PRIMARY KEY (id)
);
```

### 正确示例：
```sql
CREATE TABLE user (
    id BIGINT NOT NULL AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL,           -- ✅ 修正
    real_name VARCHAR(50) NULL,               -- ✅ 修正
    phone VARCHAR(20) NULL,
    email VARCHAR(100) NULL,
    role ENUM('USER','ADMIN') NULL DEFAULT 'USER',
    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,  -- ✅ 修正
    PRIMARY KEY (id)
);
```

---

## 二、meeting_room表

### 错误示例：
```sql
CREATE TABLE meeting_room (
    id BIGINT NOT NULL AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    room_number VARCGAR(50) NOT NULL,         -- ❌ 拼写错误
    capacity INT NOT NULL,
    area VDECIMAL(10,2) NULL,                 -- ❌ 拼写错误
    purpose VARCHAR(200) NULL,
    photo_url VARCHAR(500) NULL,
    status ENUM('AVAILABLE','UNAVAILABLE') NULL DEFAULT 'AVAILABLE',  -- ✅ 正确
    create_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    updata_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,  -- ❌ 拼写错误+缺少ON UPDATE
    PRIMARY KEY (id)
);
```

### 正确示例：
```sql
CREATE TABLE meeting_room (
    id BIGINT NOT NULL AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    room_number VARCHAR(50) NOT NULL,         -- ✅ 修正
    capacity INT NOT NULL,
    area DECIMAL(10,2) NULL,                  -- ✅ 修正
    purpose VARCHAR(200) NULL,
    photo_url VARCHAR(500) NULL,
    status ENUM('AVAILABLE','UNAVAILABLE') NULL DEFAULT 'AVAILABLE',
    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP 
        ON UPDATE CURRENT_TIMESTAMP,          -- ✅ 修正：添加ON UPDATE
    PRIMARY KEY (id)
);
```

---

## 三、booking表（最严重的错误）

### ❌ 错误示例：
```sql
CREATE TABLE booking (
    id BIGINT NOT NULL AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    room_id BIGINT NOT NULL,
    booking_data DATE NOT NULL,               -- ❌ 拼写错误
    start_time TIME NOT NULL,
    end_time TIME NOT NULL,
    attendess_count INT NOT NULL,             -- ❌ 拼写错误
    meeting_topic VARCHAR(200) NOT NULL,
    status ENUM('PENDING','APPROVED','REJECTED','CANCELLED') 
        NULL DEFAULT CURRENT_TIMESTAMP,       -- ❌❌❌ 严重错误！
    approval_time TIMESTAMP NULL,
    reject_reason VARCHAR(500) NULL,
    is_confirmed BOOLEAN NULL DEFAULT FALSE,  -- ✅ 正确
    create_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);
```

### ✅ 正确示例：
```sql
CREATE TABLE booking (
    id BIGINT NOT NULL AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    room_id BIGINT NOT NULL,
    booking_date DATE NOT NULL,               -- ✅ 修正
    start_time TIME NOT NULL,
    end_time TIME NOT NULL,
    attendees_count INT NOT NULL,             -- ✅ 修正
    meeting_topic VARCHAR(200) NOT NULL,
    status ENUM('PENDING','APPROVED','REJECTED','CANCELLED') 
        NULL DEFAULT 'PENDING',               -- ✅ 修正：使用ENUM值
    approval_time TIMESTAMP NULL,
    reject_reason VARCHAR(500) NULL,
    is_confirmed BOOLEAN NULL DEFAULT FALSE,
    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);
```

---

## 错误统计

### 🔴 严重错误（导致建表失败）
1. **booking.status** - `DEFAULT CURRENT_TIMESTAMP` 用于ENUM类型
   - 影响：SQL执行失败，无法创建表
   - 错误类型：类型不匹配

### 🟡 中等错误（影响功能）
2. **meeting_room.updated_at** - 缺少 `ON UPDATE CURRENT_TIMESTAMP`
   - 影响：时间戳不会自动更新
   - 错误类型：功能缺失

### 🟢 轻微错误（不影响功能但降低代码质量）
3. **数据类型拼写错误** (3处)
   - `VARCGAR` → `VARCHAR` (2处)
   - `VDECIMAL` → `DECIMAL` (1处)
   
4. **字段名拼写错误** (4处)
   - `Real_name` → `real_name`
   - `Create_at` → `created_at`
   - `updata_at` → `updated_at`
   - `booking_data` → `booking_date`
   - `attendess_count` → `attendees_count`

---

## MySQL默认值测试

### ✅ 这些默认值设置是正确的：

```sql
-- ENUM类型使用ENUM值
role ENUM('USER','ADMIN') DEFAULT 'USER'

-- TIMESTAMP使用CURRENT_TIMESTAMP
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

-- BOOLEAN使用TRUE/FALSE
is_confirmed BOOLEAN DEFAULT FALSE

-- VARCHAR使用字符串
name VARCHAR(50) DEFAULT 'Unknown'

-- INT使用数字
count INT DEFAULT 0
```

### ❌ 这些默认值设置是错误的：

```sql
-- ENUM类型不能使用CURRENT_TIMESTAMP
status ENUM('PENDING','APPROVED') DEFAULT CURRENT_TIMESTAMP  -- 错误！

-- ENUM类型不能使用数字（除非ENUM值是数字字符串）
type ENUM('A','B','C') DEFAULT 0  -- 错误！

-- BOOLEAN不能使用字符串
is_active BOOLEAN DEFAULT 'true'  -- 错误！(应该是TRUE或1)
```

---

## 结论

**问题答案：不是所有默认值都能按原设计设置！**

特别是**booking表的status字段**，使用`DEFAULT CURRENT_TIMESTAMP`作为ENUM类型的默认值是**完全错误的**，会导致建表失败。

必须修改为：
```sql
status ENUM('PENDING','APPROVED','REJECTED','CANCELLED') DEFAULT 'PENDING'
```

其他错误虽然不会导致建表失败，但应该修正以提高代码质量和可维护性。
